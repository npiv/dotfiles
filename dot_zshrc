# Setup zplug
# --------------------------------------
if [[ "$OSTYPE" == darwin* ]]; then
  export ZPLUG_HOME=$HOMEBREW_PREFIX/opt/zplug
else
  export ZPLUG_HOME=$HOME/.zplug
fi

source $ZPLUG_HOME/init.zsh

zplug mafredri/zsh-async, use:async.zsh, from:github
zplug modules/history, from:prezto
zplug modules/completion, from:prezto

# Install plugins if there are plugins that have not been installed
if ! zplug check; then
  zplug install
fi

zplug load # --verbose (if curious what is going on)

# load autojump if there
[ -f $(brew --prefix)/etc/profile.d/autojump.sh ] && . $(brew --prefix)/etc/profile.d/autojump.sh

# set nvim as default editor if exists
if command -v nvim > /dev/null; then
  export EDITOR='nvim'
  alias vi=nvim
else
  export EDITOR='vim'
fi

if [[ "$OSTYPE" == darwin* ]]; then
  # Auto-completion
  [[ $- == *i* ]] && source "$HOMEBREW_PREFIX/opt/fzf/shell/completion.zsh" 2> /dev/null

  # Key bindings
  source "$HOMEBREW_PREFIX/opt/fzf/shell/key-bindings.zsh"
else
  if [[ ! "$PATH" == */$HOME/.fzf/bin* ]]; then
    export PATH="$PATH:$HOME/.fzf/bin"
  fi

  # Auto-completion
  # ---------------
  [[ $- == *i* ]] && source "$HOME/.fzf/shell/completion.zsh" 2> /dev/null

  # Key bindings
  # ------------
  source "$HOME/.fzf/shell/key-bindings.zsh"
fi


# ensure ls uses colors
if [[ "$OSTYPE" == darwin* ]]; then
  alias ls="ls -G"
else
  alias ls="ls --color=auto"
fi

eval "$(starship init zsh)"

# load local (non-suitable for pushing to GH) tweaks
[ -f ~/.zshrc.local ] && source ~/.zshrc.local
